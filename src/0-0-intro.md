# 前言
当你理解了一门语言的思想，其语法往往是自然而然的。反过来，一门语言最有趣的也正是它的思想。虽说世上不可能有完美的语言，所有语言都要在各种矛盾中权衡而做不到万全，但这不妨碍 rust 有几处思想颇有见地。而其中最广泛存在和影响这门语言的，可能是如下两条：

第一，rust 鼓励甚至强制实现**明确化**（explicitness），即让使用者对他在做的事完全了解和掌控。当今绝大多数语言似乎都营造了一个假象，即你不需要了解一切、不需要熟悉计算机工作原理、不需要熟悉编译机制，也可以编程。这种假象，或者由于语言限制很多、或者由于语言限制太少，这两种截然不同的理由。前者的一个例子是垃圾回收：垃圾回收对于内存管理是有诸多限制的，比如程序员并不能自己决定内存释放的时间，而这使得程序员不需要了解内存的工作机制也能编程，这很多时候是个好的假象，但是也是个很强的限制；而后者的例子是指针，程序员可以使用指针对内存直接操作，指针也可以任意运算，而只要结果正确，很多细节往往容易得过且过，这种假象不一定是语言想要的结果，也未必是好事了。

> With great power comes great responsibility.
>
> — `sudo` lecture

实际上，对计算机越多控制，越需要对计算机深入理解，这从本质上就是绕不开的，而 rust 认识到了这一点。Rust 作为系统编程语言，没有试图遮遮掩掩，而是将所有底层细节在语言层面，较以前更为提前、更为明确地暴露出来。举例而言，C 和 C++ 中，一个 struct 的主要数据存储在栈还是堆上，是不能很显然看出来的，本质上也是因为指针就没有对应的区分；但 rust 中栈和堆上的“指针”是有不同的语法语义的，在更高的 struct 层次，数据存储位置也可以很明显地通过 Copy trait 区分。类似这些也导致了 rust 的一个广为人知的特点：很难通过编译，学习成本极高。但这并不是 rust 的劣势，rust 其实并没有平添复杂性，而是把本来的复杂性尽可能早地真实完整地暴露给使用者而已。一方面它打碎了一些不切实际的假象，而另一方面，一旦你写出可以通过编译的 rust 程序，你会对程序拥有前所未有的信心，因为语言虽不能保证你万无一失，但在努力保证你完全清楚你在做的事情。

第二，rust 在不失明确的前提下，利用尽可能强大的**抽象**（abstraction），让使用者不至于迷失在细节当中。抽象而不失细节的最好例子可能是数学，也正是得益于其明确性。对比更加数学化的语言（如 Haskell），rust 借鉴了其中大量抽象思想，但除了对数学化抽象本身的明确性、又增加了对系统的明确性，使得 rust 很好地将高层抽象和底层细节合并起来。这让 rust 作为一个系统级语言，表达力也能够毫不落伍。

值得一提的是，rust 在数学性的抽象（函数等）、和为了让功能使用变得更加容易而存在的语言特征（宏）之间，有较为明显的区分，这也是之前不曾有的。甚至在你的第一个“你好，世界”程序里，rust 也会通过 `!` 明确告诉你，`println!` 不是个单纯的（数学性的）函数，而只是一组程序的简洁写法。我们可以认为宏是语言词法层次的抽象：可将一套无法用前述抽象机制实现、但形式上多有繁复的代码片段，抽象为一个新的词法；或者通俗而言，可以就理解为操作代码本身的代码（即所谓元编程）。这样的区分，使得 rust 能维持精简而专注的抽象内核，同时仍然能提供大量实际便利；另一方面，明确这种区分，也如前文所说，能够不失精细控制、提升对程序的认识和信心。

可以说，这两条是 rust 能作为系统语言存在的前提和优势所在。Rust 程序员第一本教科书（[The Rust Programming Language](https://doc.rust-lang.org/book/)）特意提到 rust 的核心价值是**赋能**（empowerment），也正是从这两点中体现：rust 程序员从明确中获得更多信心，从高度抽象中获得处理更复杂事务的能力和更广阔的可能性。当然 rust 远不止于此，诸多设计选择、实现细节、还有很多来自当前时代其他语言的最佳实践中，也都蕴含了许多思想。这些或零或整、或明或暗的思想，这些思想对语言的影响，以及这些思想对于编译器实现会有哪些新的需求，正是本书的主题。虽不敢说完整通透，也至少能管中窥豹、可见一斑。

由于本书的目的是在思想和思维方式的层面讨论 rust，所有的语言细节均是用来体现思想的例子，因此这本书绝不能算是 rust 或系统编程的入门教程，对 rust 的介绍也并不全面和系统。基于此，这本书并不是很适合初学计算机或编程语言的人阅读。第一次接触一个事物，最重要的还是要保持兴趣，尝试做以前做不到的事。思考、总结、优化往往是后话。

> Premature optimization is the root of all evil. （过早优化是万恶之源。）
>
> — Donald Knuth

Rust 至今仍算是个正在快速发展的语言，谁也无法做到完整掌握，更无法预测未来。这一点对很多其他语言也是成立的。作为程序员该如何思考编程本身、如何发展完善自己的思考方式和思维过程，或许比理解一门特定的语言更为重要，因为这些是不会过时的。这就好比摄影师更需要理解光线和构图，而不是相机的操作细节。这也是写作本书的最大动机了。
